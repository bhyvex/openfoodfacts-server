apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: po-frontend
  labels:
    app: po
    component: frontend
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: po
        component: frontend
    spec:
      containers:
        - name: po-frontend
          image: openfoodfacts/productopener-frontend
          lifecycle:
            postStart:
              exec:
                command:
                - '/bin/sh'
                - '-c'
                - >
                  cp -Lrf /tmp/nginx.conf /etc/nginx/conf.d/default.conf;
                  nginx -s reload; touch /var/log/nginx/conf.done
          ports:
            - containerPort: 80
          volumeMounts:
            - name: frontend-config
              mountPath: "/tmp/nginx.conf"
              subPath: nginx.conf
            - name: product-images
              mountPath: "/opt/product-opener/html/images/products/"
      volumes:
        - name: frontend-config
          configMap:
            name: po-frontend-config
        - name: product-images
          persistentVolumeClaim:
            claimName: po-images
